<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì í†µí•© ëŒ€ì‹œë¶€</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #fdfaf1;
            font-family: 'Pretendard', sans-serif;
        }
        .container {
            margin-top: 60px;
        }
        .section-box {
            background-color: #ffffff;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 40px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.06);
        }
        h2 {
            margin-bottom: 20px;
            font-weight: bold;
        }
        table {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- í”„ë¡œì íŠ¸ í˜„í™© -->
    <div class="section-box">
        <h2>ğŸ“¦ ì „ì²´ ê²½ë§¤ í˜„í™©</h2>
        <table class="table table-striped table-bordered" id="projectTable">
            <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>ì œëª©</th>
                <th>ì˜ë£Œì</th>
                <th>ìƒíƒœ</th>
                <th>ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- ìœ ì € ëª©ë¡ -->
    <div class="section-box">
        <h2>ğŸ‘¥ íšŒì› ëª©ë¡</h2>
        <table class="table table-striped table-bordered" id="userTable">
            <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>ì´ë¦„</th>
                <th>ìœ í˜•</th>
                <th>ì´ë©”ì¼</th>
                <th>ê°€ì…ì¼</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- ì…ì°© ëª©ë¡ -->
    <div class="section-box">
        <h2>ğŸ“ˆ ì…ì°° í˜„í™©</h2>
        <table class="table table-striped table-bordered" id="bidTable">
            <thead class="table-light">
            <tr>
                <th>ì…ì°© ID</th>
                <th>í”„ë¡œì íŠ¸</th>
                <th>í”„ë¦¬ëœì„œ</th>
                <th>ê¸ˆì•¡</th>
            </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function () {
        $.get("/api/auth/me")
            .done(user => {
                if (user.userType !== 'ADMIN') {
                    alert("ê°€ì…ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
                    location.href = "/";
                    return;
                }
                loadAdminData();
            })
            .fail(() => {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                location.href = "/login";
            });

        function loadAdminData() {
            $.getJSON("/api/board", res => {
                const tbody = $("#projectTable tbody").empty();
                res.data.forEach(p => {
                    tbody.append(`
                    <tr>
                        <td>${p.id}</td>
                        <td>${p.title}</td>
                        <td>${p.username}</td>
                        <td>${p.status}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-danger" onclick="closeProject(${p.id})">ë§ˆê°</button>
                        </td>
                    </tr>
                `);
                });
            });

            $.getJSON("/api/admin/users", res => {
                const tbody = $("#userTable tbody").empty();
                res.forEach(u => {
                    tbody.append(`
                    <tr>
                        <td>${u.id}</td>
                        <td>${u.username}</td>
                        <td>${u.userType}</td>
                        <td>${u.email || '-'}</td>
                        <td>${u.createdAt || '-'}</td>
                    </tr>
                `);
                });
            });

            $.getJSON("/api/admin/bids", res => {
                const tbody = $("#bidTable tbody").empty();
                res.forEach(b => {
                    tbody.append(`
                    <tr>
                               <td>${b.id}</td>
                              <td>${b.boardTitle}</td>
            <td>${b.bidderUsername}</td>
            <td>${b.amount}</td>
                    </tr>
                `);
                });
            });
        }

        window.closeProject = function (id) {
            if (!confirm("ì´ í”„ë¡œì íŠ¸ë¥¼ ë§ˆê°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            $.ajax({
                url: `/api/board/${id}/close`,
                type: "PUT",
                success: () => location.reload(),
                error: err => alert("ë§ˆê° ì‹¤íŒ¨: " + err.responseText)
            });
        };
    });
</script>
</body>
</html>