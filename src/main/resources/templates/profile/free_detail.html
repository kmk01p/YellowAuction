<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>í”„ë¦¬ëœì„œ í”„ë¡œí•„ ìˆ˜ì •</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/responsive.css">
    <style>
        body {
            background-color: #fdfaf1;
            font-family: 'Pretendard', sans-serif;
        }
        .main-card {
            max-width: 600px;
            margin: 40px auto;
            padding: 30px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.07);
        }
        .btn-gold {
            background-color: #f9c846;
            border: none;
            color: black;
        }
        .btn-gold:hover {
            background-color: #f6b700;
            color: white;
        }
        /* ê¸°ìˆ ì¹© ìŠ¤íƒ€ì¼ */
        .tech-option {
            display: inline-block;
            padding: 6px 12px;
            margin: 4px;
            border: 1px solid #ccc;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .tech-option.selected {
            background-color: #f9c846;
            border-color: #f9c846;
            color: black;
            font-weight: 600;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/">YellowAuction</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navMenu">
            <ul class="navbar-nav">
                <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë§í¬ í‘œì‹œ -->
                <li class="nav-item" th:if="${session.loginUser != null}">
                    <a class="nav-link" th:if="${session.loginUser.userType=='EMPLOYER'}"
                       th:href="@{/dashboard/com_dashboard.html}">ğŸ  í™ˆ</a>
                    <a class="nav-link" th:if="${session.loginUser.userType=='FREELANCER'}"
                       th:href="@{/dashboard/free_dashboard.html}">ğŸ  í™ˆ</a>
                </li>
                <li class="nav-item" th:if="${session.loginUser != null}">
                    <a class="nav-link" th:href="@{/profile/free_list.html}">ğŸ“‚ ë§ˆì´í˜ì´ì§€</a>
                </li>
                <li class="nav-item" th:if="${session.loginUser != null}">
                    <a class="nav-link" th:href="@{/board/list.html}">ğŸ“‹ ê²½ë§¤ ëª©ë¡</a>
                </li>
                <li class="nav-item" th:if="${session.loginUser != null}">
                    <a class="nav-link" th:href="@{/logout}">ğŸ”“ ë¡œê·¸ì•„ì›ƒ</a>
                </li>
                <li class="nav-item" th:if="${session.loginUser == null}">
                    <a class="nav-link" th:href="@{/login}">ğŸ”‘ ë¡œê·¸ì¸</a>
                </li>
                <li class="nav-item" th:if="${session.loginUser == null}">
                    <a class="nav-link" th:href="@{/register}">ğŸ“ íšŒì›ê°€ì…</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="main-card">
    <h2 class="text-center mb-4">ğŸ‘¨â€ğŸ’» í”„ë¦¬ëœì„œ í”„ë¡œí•„ ìˆ˜ì •</h2>
    <input type="hidden" id="profileId">

    <!-- ì´ë¦„ -->
    <div class="mb-3">
        <label for="name" class="form-label">ì´ë¦„</label>
        <input type="text" id="name" class="form-control" placeholder="ì´ë¦„">
    </div>

    <!-- í¬ë§ ì§ë¬´ -->
    <div class="mb-3">
        <label for="jobType" class="form-label">í¬ë§ ì§ë¬´</label>
        <input type="text" id="jobType" class="form-control" placeholder="ì˜ˆ: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì">
    </div>

    <!-- ê²½ë ¥ -->
    <div class="mb-3">
        <label for="career" class="form-label">ê²½ë ¥(ë…„)</label>
        <input type="number" id="career" class="form-control" placeholder="ì˜ˆ: 3">
    </div>

    <!-- í¬íŠ¸í´ë¦¬ì˜¤ URL -->
    <div class="mb-3">
        <label for="homepageUrl" class="form-label">í¬íŠ¸í´ë¦¬ì˜¤ URL</label>
        <input type="url" id="homepageUrl" class="form-control" placeholder="https://">
    </div>

    <!-- ì „í™”ë²ˆí˜¸ -->
    <div class="mb-3">
        <label for="phone" class="form-label">ì „í™”ë²ˆí˜¸</label>
        <input type="text" id="phone" class="form-control" placeholder="ì˜ˆ: 010-1234-5678">
    </div>

    <!-- ì´ë©”ì¼ -->
    <div class="mb-3">
        <label for="email" class="form-label">ì´ë©”ì¼</label>
        <input type="email" id="email" class="form-control" placeholder="you@example.com">
    </div>

    <!-- ì‚¬ìš© ê¸°ìˆ  -->
    <div class="col-12">
        <label class="form-label">ì‚¬ìš© ê¸°ìˆ </label>
        <!-- â‘  í…ìŠ¤íŠ¸ ì…ë ¥ì°½ ì¶”ê°€ -->
        <input type="text"
               id="techInput"
               class="form-control mb-2"
               placeholder="ê¸°ìˆ  ì…ë ¥ í›„ Enter">
        <div id="techOptions" class="border rounded p-3">
            <span class="tech-option">Java</span>
            <span class="tech-option">Javascript</span>
            <span class="tech-option">MySQL</span>
            <span class="tech-option">React</span>
            <span class="tech-option">JPA</span>
            <span class="tech-option">HTML</span>
            <span class="tech-option">CSS</span>
            <span class="tech-option">Git</span>
            <span class="tech-option">SQL</span>
            <span class="tech-option">MyBatis</span>
            <span class="tech-option">TypeScript</span>
            <span class="tech-option">ê³„íšì„±</span>
            <span class="tech-option">ê³µê°ëŠ¥ë ¥</span>
            <span class="tech-option">ê³ ê°ì§€í–¥ì„±</span>
        </div>
    </div>

    <!-- ë²„íŠ¼ ê·¸ë£¹ -->
    <div class="d-flex justify-content-center gap-2 mt-4">
        <button id="saveBtn" class="btn btn-gold px-4">ì €ì¥</button>
        <button class="btn btn-outline-secondary px-4"
                onclick="location.href='/profile/free_list.html'">
            ëª©ë¡ìœ¼ë¡œ
        </button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function(){
        // 1) í”„ë¡œí•„ ID ì¶”ì¶œ
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        if(!id) {
            alert('í”„ë¡œí•„ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }
        $('#profileId').val(id);

        // 2) í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ
        function loadProfile(){
            $.getJSON(`/api/profile/${id}`, res => {
                const p = res.data;
                $('#name').val(p.name);
                $('#jobType').val(p.jobType || '');
                $('#career').val(p.career);
                $('#homepageUrl').val(p.homepageUrl || '');
                $('#phone').val(p.phone);
                $('#email').val(p.email);
                // ê¸°ì¡´ ê¸°ìˆ  ìŠ¤íƒ ë³µì›
                p.techStack?.forEach(t => {
                    const chip = $('<span class="tech-option selected"></span>').text(t);
                    $('#techOptions').append(chip);
                });
            })
                .fail(() => {
                    alert('í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                });
        }

        // 3) ê¸°ìˆ ì¹© í´ë¦­ í† ê¸€
        $('#techOptions').on('click', '.tech-option', function(){
            $(this).toggleClass('selected');
        });

        // 4) Enter í‚¤ë¡œ ê¸°ìˆ ì¹© ì¶”ê°€/í† ê¸€
        $('#techInput').on('keydown', function(e){
            if(e.key === 'Enter'){
                e.preventDefault();
                const val = $(this).val().trim();
                if(!val) return;
                const exist = $('#techOptions .tech-option').filter((_,el)=>$(el).text()===val);
                if(exist.length) {
                    exist.toggleClass('selected');
                } else {
                    $('<span class="tech-option selected"></span>').text(val).appendTo('#techOptions');
                }
                $(this).val('');
            }
        });

        // 5) ì €ì¥ (PUT)
        $('#saveBtn').click(() => {
            const techs = $('#techOptions .tech-option.selected')
                .map((_,el)=>$(el).text()).get();
            const dto = {
                name:        $('#name').val(),
                jobType:     $('#jobType').val(),
                career:      $('#career').val(),
                homepageUrl: $('#homepageUrl').val(),
                phone:       $('#phone').val(),
                email:       $('#email').val(),
                techStack:   techs
            };
            $.ajax({
                url: `/api/profile/${id}`,
                method: 'PUT',
                contentType: 'application/json; charset=UTF-8',
                data: JSON.stringify(dto),
                success(){
                    alert('ìˆ˜ì • ì™„ë£Œ');
                    location.href = '/profile/free_list.html';
                },
                error(xhr){
                    alert('ìˆ˜ì • ì‹¤íŒ¨: ' + xhr.responseText);
                }
            });
        });

        loadProfile();
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
